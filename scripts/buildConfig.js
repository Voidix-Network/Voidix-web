import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

/**
 * æ„å»ºé…ç½®æ¨¡å—
 * ç»Ÿä¸€ç®¡ç†æ‰€æœ‰æ„å»ºç›¸å…³çš„é…ç½®
 */

// åŸºç¡€è·¯å¾„é…ç½®
export const BUILD_CONFIG = {
  // é¡¹ç›®æ ¹ç›®å½•
  rootDir: path.resolve(__dirname, '..'),

  // æ„å»ºè¾“å‡ºç›®å½•
  distDir: path.resolve(__dirname, '..', 'dist'),

  // å…¬å…±èµ„æºç›®å½•
  publicDir: path.resolve(__dirname, '..', 'public'),

  // æºä»£ç ç›®å½•
  srcDir: path.resolve(__dirname, '..', 'src'),
};

// é¢„æ¸²æŸ“é…ç½®
export const PRERENDER_CONFIG = {
  // æœåŠ¡å™¨é…ç½®
  server: {
    port: 4173,
    host: 'localhost',
  },

  // éœ€è¦é¢„æ¸²æŸ“çš„è·¯ç”±
  routes: [
    { path: '/', outputDir: '' },
    { path: '/status', outputDir: 'status' },
    { path: '/faq', outputDir: 'faq' },
    { path: '/bug-report', outputDir: 'bug-report' },
    { path: '/privacy', outputDir: 'privacy' },
    { path: '/not-found', outputDir: 'not-found' },
  ],

  // ğŸ”¥ HTMLç»ˆæå‹ç¼©é…ç½® - å¹³è¡¡ä¼˜åŒ–ç‰ˆ
  htmlMinify: {
    // === åŸºç¡€å‹ç¼© ===
    collapseWhitespace: true, // âœ… å‹ç¼©ç©ºç™½ç¬¦
    removeComments: true, // âœ… ç§»é™¤æ³¨é‡Š
    removeRedundantAttributes: true, // âœ… ç§»é™¤å†—ä½™å±æ€§
    removeScriptTypeAttributes: true, // âœ… ç§»é™¤script type
    removeStyleLinkTypeAttributes: true, // âœ… ç§»é™¤style/link type
    useShortDoctype: true, // âœ… ä½¿ç”¨çŸ­DOCTYPE
    removeEmptyAttributes: true, // âœ… ç§»é™¤ç©ºå±æ€§
    html5: true, // âœ… HTML5æ¨¡å¼
    caseSensitive: false, // âœ… å¤§å°å†™ä¸æ•æ„Ÿ

    // === ğŸ”¥ æé™å‹ç¼©é€‰é¡¹ ===
    removeOptionalTags: false,
    removeAttributeQuotes: false,
    removeEmptyElements: true, // ğŸ”¥ ç§»é™¤ç©ºå…ƒç´ 
    collapseBooleanAttributes: true, // ğŸ”¥ å‹ç¼©å¸ƒå°”å±æ€§ï¼ˆcheckedè€Œéchecked="checked"ï¼‰
    collapseInlineTagWhitespace: true, // ğŸ”¥ å‹ç¼©å†…è”æ ‡ç­¾ç©ºç™½
    conservativeCollapse: false, // ğŸ”¥ æ¿€è¿›ç©ºç™½å‹ç¼©
    decodeEntities: true, // ğŸ”¥ è§£ç HTMLå®ä½“
    includeAutoGeneratedTags: false, // ğŸ”¥ ä¸åŒ…å«è‡ªåŠ¨ç”Ÿæˆæ ‡ç­¾
    keepClosingSlash: false, // ğŸ”¥ ç§»é™¤è‡ªé—­åˆæ ‡ç­¾çš„æ–œæ 
    processConditionalComments: true, // ğŸ”¥ å¤„ç†æ¡ä»¶æ³¨é‡Š
    processScripts: ['text/html'], // ğŸ”¥ å¤„ç†è„šæœ¬å†…å®¹
    removeTagWhitespace: true, // ğŸ”¥ ç§»é™¤æ ‡ç­¾é—´ç©ºç™½
    sortAttributes: true, // ğŸ”¥ æ’åºå±æ€§ï¼ˆå‡å°‘gzipé‡å¤ï¼‰
    sortClassName: true, // ğŸ”¥ æ’åºclassåï¼ˆå‡å°‘gzipé‡å¤ï¼‰
    trimCustomFragments: true, // ğŸ”¥ ä¿®å‰ªè‡ªå®šä¹‰ç‰‡æ®µ

    // === CSS/JS å†…è”å‹ç¼© ===
    minifyCSS: {
      level: 2, // ğŸ”¥ CSSæœ€é«˜çº§åˆ«å‹ç¼©
      compatibility: '*', // ğŸ”¥ å¿½ç•¥å…¼å®¹æ€§è­¦å‘Š
    },
    minifyJS: {
      compress: {
        drop_console: true, // ğŸ”¥ ç§»é™¤console
        drop_debugger: true, // ğŸ”¥ ç§»é™¤debugger
        pure_funcs: ['console.log'], // ğŸ”¥ çº¯å‡½æ•°ä¼˜åŒ–
      },
      mangle: true, // ğŸ”¥ æ··æ·†å˜é‡å
      format: {
        comments: false, // ğŸ”¥ ç§»é™¤æ‰€æœ‰æ³¨é‡Š
      },
    },

    // === é«˜çº§é€‰é¡¹ ===
    ignoreCustomComments: [/^!/], // ä¿ç•™é‡è¦æ³¨é‡Šï¼ˆå¦‚è®¸å¯è¯ï¼‰
    maxLineLength: 0, // ğŸ”¥ æ— è¡Œé•¿åº¦é™åˆ¶ï¼ˆå•è¡Œè¾“å‡ºï¼‰
    preserveLineBreaks: false, // ğŸ”¥ ä¸ä¿ç•™æ¢è¡Œç¬¦
    preventAttributesEscaping: false, // ğŸ”¥ å…è®¸å±æ€§è½¬ä¹‰ä¼˜åŒ–
    quoteCharacter: '"', // ç»Ÿä¸€å¼•å·é£æ ¼
  },

  // Puppeteer é…ç½®
  puppeteer: {
    headless: true,
    args: [
      '--no-sandbox',
      '--disable-setuid-sandbox',
      '--disable-dev-shm-usage',
      '--disable-accelerated-2d-canvas',
      '--no-first-run',
      '--no-zygote',
      '--disable-gpu',
    ],
  },

  // æ¸²æŸ“ç­‰å¾…é…ç½®
  render: {
    waitTime: 3000, // ç­‰å¾…Reactæ¸²æŸ“å®Œæˆ
    networkIdleTime: 500, // ç½‘ç»œç©ºé—²æ—¶é—´
    viewportWidth: 1920, // è§†å£å®½åº¦
    viewportHeight: 1080, // è§†å£é«˜åº¦
    timeout: 30000, // é¡µé¢åŠ è½½è¶…æ—¶
  },
};

// Sitemapé…ç½®
export const SITEMAP_CONFIG = {
  // æ–‡ä»¶è·¯å¾„
  files: {
    sitemap: 'sitemap.xml',
    robots: 'robots.txt',
  },

  // XMLé…ç½®
  xml: {
    declaration: '<?xml version="1.0" encoding="UTF-8"?>',
    namespace: 'http://www.sitemaps.org/schemas/sitemap/0.9',
    schemaLocation: 'http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd',
  },

  // Robots.txté…ç½®
  robots: {
    userAgent: '*',
    allow: '/',
    disallow: ['/admin/', '/private/'],
    crawlDelay: 1,
  },
};
