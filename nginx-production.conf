# Voidixç½‘ç«™ç”Ÿäº§ç¯å¢ƒNginxé…ç½®
# åŸºäºç°ä»£React+TypeScript+Viteæ¶æ„ä¼˜åŒ–
#
# ğŸ”’ SSL/TLSåŒè¯ä¹¦é…ç½®è¯´æ˜ï¼š
# - ECCè¯ä¹¦ï¼šç°ä»£æµè§ˆå™¨ä¼˜å…ˆï¼Œæ€§èƒ½æœ€ä½³ï¼Œä½“ç§¯æœ€å°
# - RSAè¯ä¹¦ï¼šä¼ ç»Ÿæµè§ˆå™¨å…¼å®¹ï¼Œå‘åå…¼å®¹æ€§æœ€å¥½
#
# ğŸš€ å½“å‰ç®—æ³•ä¼˜å…ˆçº§ï¼šECC > RSA
# ğŸ”¥ A+è¯„çº§SSLé…ç½®ï¼šå‰å‘ä¿å¯†ä¼˜å…ˆã€TLS 1.3ã€HSTS 2å¹´æœŸé™

# ============================================================================
# ğŸ”’ HSTSå®‰å…¨æ”¯æŒ - HTTPå¼ºåˆ¶é‡å®šå‘åˆ°HTTPS
# ============================================================================

# ğŸ¯ HSTS Preloadä¸“ç”¨é…ç½®ï¼šæ ¹åŸŸåHTTPé‡å®šå‘
server {
    listen 80;
    listen [::]:80;
    server_name voidix.net;

    # ğŸš€ HSTS Preloadè¦æ±‚ï¼šæ ¹åŸŸåå…ˆé‡å®šå‘åˆ°è‡ªå·±çš„HTTPS
    return 301 https://voidix.net$request_uri;
}

# wwwå­åŸŸåHTTPé‡å®šå‘
server {
    listen 80;
    listen [::]:80;
    server_name www.voidix.net;

    # ğŸš€ wwwå­åŸŸåç›´æ¥é‡å®šå‘åˆ°wwwçš„HTTPS
    return 301 https://www.voidix.net$request_uri;
}

# CDN HTTPé‡å®šå‘
server {
    listen 80;
    listen [::]:80;
    server_name cdn.voidix.net;

    # ğŸš€ CDNé‡å®šå‘åˆ°HTTPS
    return 301 https://cdn.voidix.net$request_uri;
}

# ğŸ”’ é€šé…ç¬¦å­åŸŸåHTTPSé‡å®šå‘æ”¯æŒ
server {
    listen 80 default_server;
    listen [::]:80 default_server;
    server_name _;

    # ğŸš€ æ‰€æœ‰å…¶ä»–å­åŸŸåé‡å®šå‘åˆ°ä¸»ç«™HTTPS
    return 301 https://www.voidix.net$request_uri;
}

# ============================================================================
# CDNä»£ç†é…ç½®è¯´æ˜
# ============================================================================
# æœ¬é…ç½®åŒ…å«CDNä»£ç†åŠŸèƒ½ï¼Œéœ€è¦åœ¨ä¸»nginx.confçš„httpå—ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š
# proxy_cache_path /var/cache/nginx/voidix levels=1:2 keys_zone=voidix_cache:50m inactive=180m max_size=5g;
# proxy_temp_path /var/cache/nginx/voidix_temp;
#
# ä»¥åŠRate Limitingé…ç½®ï¼š
# limit_req_zone $binary_remote_addr zone=cdn_api:20m rate=60r/m;
# limit_req_zone $binary_remote_addr zone=cdn_assets:30m rate=120r/m;
# limit_req_zone $binary_remote_addr zone=static_files:20m rate=200r/m;
#
# ä»£ç†åŠŸèƒ½åŒ…æ‹¬ï¼š
# - Minecraftå¤´åƒAPIä»£ç†å’Œç¼“å­˜
# - UptimeRobotç›‘æ§APIä»£ç†å’Œç¼“å­˜
# - Google Fontsä»£ç†å’Œç¼“å­˜
# - è‡ªåŠ¨æ’é™¤åˆ†æJSè„šæœ¬ï¼ˆGAã€å­—èŠ‚è·³åŠ¨ç­‰ï¼‰
# - SEOå‹å¥½çš„CDNé˜²ç›—é“¾ä¿æŠ¤æœºåˆ¶ï¼ˆå…è®¸æœç´¢å¼•æ“çˆ¬è™«ï¼‰
# ============================================================================

# ============================================================================
# ä¸»ç«™HTTPSé…ç½® - www.voidix.net
# ============================================================================
server {
    listen 443 ssl http2 default_server;
    listen [::]:443 ssl http2 default_server;
    server_name www.voidix.net;

    # ç½‘ç«™æ ¹ç›®å½•
    root /var/www/voidix.net/dist;
    index index.html;

    # æ€§èƒ½åŠIOä¼˜åŒ–
    large_client_header_buffers 16 128k;
    keepalive_requests 50000;
    http2_max_concurrent_streams 256;
    http2_push_preload on;
    postpone_output 0;
    tcp_nopush off;
    tcp_nodelay on;
    sendfile on;
    sendfile_max_chunk 512k;
    aio threads;
    directio 4m;
    lingering_close off;
    lingering_time 1s;
    reset_timedout_connection on;

    # SSLåŒè¯ä¹¦é…ç½® - ECCä¼˜å…ˆï¼ŒRSAå…¼å®¹
    ssl_certificate /etc/nginx/ssl/voidix.net/ECC/voidix.cer;
    ssl_certificate_key /etc/nginx/ssl/voidix.net/ECC/voidix.key;
    ssl_certificate /etc/nginx/ssl/voidix.net/RSA/voidix.cer;
    ssl_certificate_key /etc/nginx/ssl/voidix.net/RSA/voidix.key;

    # SSLä¼˜åŒ–é…ç½® (A+è¯„çº§)
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers 'ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-CHACHA20-POLY1305-SHA256:ECDHE-RSA-CHACHA20-POLY1305-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!SRP:!CAMELLIA:!DHE';
    ssl_prefer_server_ciphers on;
    ssl_session_cache shared:SSL:100m;
    ssl_session_timeout 24h;
    ssl_session_tickets off;
    ssl_buffer_size 4k;
    ssl_early_data on;
    ssl_conf_command Ciphersuites TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256;
    ssl_conf_command Options PrioritizeChaCha;
    ssl_conf_command Options NoRenegotiation;
    ssl_stapling on;
    ssl_stapling_verify on;
    ssl_trusted_certificate /etc/nginx/ssl/voidix.net/ECC/voidix.cer;
    resolver 8.8.8.8 8.8.4.4 valid=300s;
    resolver_timeout 5s;
    ssl_ecdh_curve X25519:X448:secp384r1:secp521r1:secp256r1;

    # ============================================================================
    # âœ¨ å…¨å±€å®‰å…¨ä¸æ€§èƒ½å¤´éƒ¨ (å·²æ•´åˆ)
    # åœ¨serverå—ä¸­ç»Ÿä¸€å®šä¹‰ï¼Œé¿å…åœ¨locationä¸­é‡å¤ï¼Œç®€åŒ–ç»´æŠ¤
    # 'always'å‚æ•°ç¡®ä¿å¤´éƒ¨åœ¨æ‰€æœ‰å“åº”ç ï¼ˆåŒ…æ‹¬é”™è¯¯é¡µï¼‰ä¸­éƒ½ç”Ÿæ•ˆ
    # ============================================================================
    add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload" always;
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    add_header X-DNS-Prefetch-Control "on" always;
    add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.googletagmanager.com https://www.google-analytics.com https://lf1-cdn-tos.bytegoofy.com https://b.clarity.ms https://k.clarity.ms https://*.clarity.ms; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdn.voidix.net; font-src 'self' https://fonts.gstatic.com https://cdn.voidix.net; img-src 'self' data: https: blob: https://cdn.voidix.net; connect-src 'self' https://www.google-analytics.com https://api.uptimerobot.com https://cdn.voidix.net wss://$host wss://server.voidix.top:10203 https://b.clarity.ms https://k.clarity.ms https://*.clarity.ms; object-src 'none'; base-uri 'self'; form-action 'self';" always;


    # é¢„å‹ç¼©æ–‡ä»¶é…ç½®ï¼ˆé›¶CPUæ¶ˆè€—ï¼‰
    brotli_static on;
    brotli off;
    brotli_min_length 128;
    brotli_types text/plain text/css text/xml text/javascript text/json application/javascript application/json application/xml application/xml+rss application/atom+xml application/rss+xml image/svg+xml font/woff font/woff2 font/ttf font/eot font/otf;

    gzip_static on;
    gzip off;
    gzip_vary on;
    gzip_min_length 128;
    gzip_types text/plain text/css text/xml text/javascript application/javascript application/json application/xml+rss application/atom+xml image/svg+xml font/woff font/woff2;

    # SEOä¼˜åŒ–ï¼šå°† /page.html é‡å®šå‘åˆ° /page
    location ~ ^/(?!index)(.+)\.html$ {
        return 301 /$1;
    }

    # é™æ€èµ„æºï¼šCSS/JS
    location ~* \.(css|js)$ {
        expires 1y;
        add_header Cache-Control "public, immutable, max-age=31536000";
        read_ahead 512k;
        open_file_cache_valid 3600s;
        try_files $uri =404;
    }

    # é™æ€èµ„æºï¼šå­—ä½“
    location ~* \.(woff|woff2|ttf|eot|otf)$ {
        add_header Link "<$uri>; rel=preload; as=font; crossorigin" always;
        expires 2y;
        add_header Cache-Control "public, immutable, max-age=63072000";
        add_header Access-Control-Allow-Origin "*";
        try_files $uri =404;
    }

    # é™æ€èµ„æºï¼šå›¾ç‰‡
    location ~* \.(png|jpg|jpeg|gif|webp|svg|ico)$ {
        expires 6M;
        add_header Cache-Control "public, immutable, max-age=15552000";
        add_header Vary "Accept";
        try_files $uri =404;
    }

    # é™æ€èµ„æºï¼šå…¶ä»– (map, txt, xml) - ä¸ç¼“å­˜
    location ~* \.(map|txt|xml)$ {
        try_files $uri =404;
        add_header Cache-Control "no-cache, no-store, must-revalidate, max-age=0";
    }

    # PWAå›¾æ ‡å’ŒLogoæ–‡ä»¶ä¸“ç”¨é…ç½®
    location ~* ^/(android-chrome-|apple-touch-icon|favicon\.|logo\.) {
        try_files $uri =404;
        expires 90d;
        add_header Cache-Control "public, immutable, max-age=7776000";
        etag on;
        add_header Link "<$uri>; rel=preload; as=image";
        access_log /var/log/nginx/voidix_icons.log;
    }

    # ä¸»è·¯ç”±é…ç½® - SPAåº”ç”¨è·¯ç”±
    location / {
        # ğŸš€ èµ„æºé¢„åŠ è½½å’Œé¢„è¿æ¥
        add_header Link "</cdn.voidix.net>; rel=dns-prefetch" always;
        add_header Link "</fonts.googleapis.com>; rel=dns-prefetch" always;
        add_header Link "</api.uptimerobot.com>; rel=dns-prefetch" always;
        add_header Link "</cdn.voidix.net>; rel=preconnect" always;
        add_header Link "</fonts.gstatic.com>; rel=preconnect; crossorigin" always;

        # ğŸš€ HTMLæ–‡ä»¶ä¸ç¼“å­˜ï¼Œç¡®ä¿ç”¨æˆ·å§‹ç»ˆè·å¾—æœ€æ–°ç‰ˆæœ¬
        add_header Cache-Control "no-cache, no-store, must-revalidate, max-age=0";

        # âœ¨ FIX: ä¿®æ­£çš„SPAè·¯ç”±å¤„ç†æ–¹å¼
        # å¦‚æœæ‰¾ä¸åˆ°é™æ€æ–‡ä»¶ï¼Œç›´æ¥è¿”å›404ã€‚Nginxä¼šæ ¹æ®error_pageæŒ‡ä»¤å¤„ç†åç»­é€»è¾‘ã€‚
        try_files $uri $uri/ =404;
    }

    # é¢„æ¸²æŸ“é¡µé¢ (SEOä¼˜åŒ–)
    location /status {
        try_files /status/index.html /index.html;
        add_header Cache-Control "no-cache, no-store, must-revalidate, max-age=0";
    }
    location /faq {
        try_files /faq/index.html /index.html;
        add_header Cache-Control "no-cache, no-store, must-revalidate, max-age=0";
    }
    location /bug-report {
        try_files /bug-report/index.html /index.html;
        add_header Cache-Control "no-cache, no-store, must-revalidate, max-age=0";
    }
    location /privacy {
        try_files /privacy/index.html /index.html;
        add_header Cache-Control "no-cache, no-store, must-revalidate, max-age=0";
    }

    # APIä»£ç†
    location /api/ {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;

        # âœ¨ OPTIMIZATION: ä½¿ç”¨ä¸æ³¨é‡Šä¸€è‡´çš„ç¼“å­˜åŒº
        proxy_cache voidix_cache;
        proxy_cache_key "$request_uri";
        proxy_cache_valid 200 5m;
        proxy_cache_valid 404 1m;
        proxy_cache_use_stale error timeout invalid_header updating;

        proxy_connect_timeout 3s;
        proxy_send_timeout 10s;
        proxy_read_timeout 30s;
    }

    # WebSocketä»£ç†
    location /ws {
        proxy_pass http://localhost:5173;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header Origin "";
        proxy_read_timeout 3600s; # 1å°æ—¶é•¿è¿æ¥
        proxy_buffering off;
    }

    # SEOæ–‡ä»¶ (robots.txt, sitemap.xml)
    location = /robots.txt {
        add_header Content-Type text/plain;
        add_header Cache-Control "no-cache, no-store, must-revalidate, max-age=0";
    }
    location = /sitemap.xml {
        add_header Content-Type application/xml;
        add_header Cache-Control "no-cache, no-store, must-revalidate, max-age=0";
    }

    # å¥åº·æ£€æŸ¥ç«¯ç‚¹
    location = /health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
    }

    # éšè—å¹¶ç¦æ­¢è®¿é—®æ•æ„Ÿæ–‡ä»¶
    location ~ /\. { deny all; }
    location ~ \.(md|json|lock|log)$ { deny all; }

    # âœ¨ FIX: ç»Ÿä¸€çš„é”™è¯¯é¡µé¢å¤„ç†
    # 404é”™è¯¯ä¼šå†…éƒ¨é‡å®šå‘åˆ°/index.htmlï¼Œå¹¶ä¿ç•™404çŠ¶æ€ç ï¼Œäº¤ç”±å‰ç«¯è·¯ç”±å¤„ç†
    # 5xxæœåŠ¡å™¨é”™è¯¯ä¹Ÿæ˜¾ç¤ºä¸»é¡µï¼Œé¿å…æš´éœ²é”™è¯¯ä¿¡æ¯
    error_page 404 /index.html;
    error_page 500 502 503 504 /index.html;

    # è®¿é—®æ—¥å¿—é…ç½®
    access_log /var/log/nginx/voidix_access.log main_perf;
    error_log /var/log/nginx/voidix_error.log;
}

# ============================================================================
# æ ¹åŸŸåHTTPSé…ç½® - voidix.net (å·²ä¼˜åŒ–ä¸ºè½»é‡çº§é‡å®šå‘æœåŠ¡å™¨)
# ============================================================================
server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name voidix.net;

    # SSLåŒè¯ä¹¦é…ç½® - ç¡®ä¿å®‰å…¨é‡å®šå‘
    ssl_certificate /etc/nginx/ssl/voidix.net/ECC/voidix.cer;
    ssl_certificate_key /etc/nginx/ssl/voidix.net/ECC/voidix.key;
    ssl_certificate /etc/nginx/ssl/voidix.net/RSA/voidix.cer;
    ssl_certificate_key /etc/nginx/ssl/voidix.net/RSA/voidix.key;

    # SSLåŸºç¡€å®‰å…¨é…ç½® (ä¿æŒA+è¯„çº§)
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers 'ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-CHACHA20-POLY1305-SHA256:ECDHE-RSA-CHACHA20-POLY1305-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!SRP:!CAMELLIA:!DHE';
    ssl_prefer_server_ciphers on;
    ssl_session_cache shared:SSL:10m; # é‡å®šå‘æœåŠ¡å™¨ä¸éœ€è¦å¤§ç¼“å­˜
    ssl_session_timeout 1h;

    # HSTSæ˜¯é‡å®šå‘æœåŠ¡å™¨æœ€é‡è¦çš„å¤´éƒ¨ä¹‹ä¸€
    add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload" always;

    # ğŸš€ å…¨å±€æ°¸ä¹…é‡å®šå‘åˆ°wwwä¸»ç«™
    return 301 https://www.voidix.net$request_uri;

    access_log /var/log/nginx/voidix_root_access.log main_perf;
    error_log /var/log/nginx/voidix_root_error.log;
}

# ============================================================================
# CDNå­åŸŸåé…ç½® - cdn.voidix.net ä¸“ç”¨ä»£ç†æœåŠ¡
# ============================================================================
server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name cdn.voidix.net;

    # æ€§èƒ½åŠIOä¼˜åŒ–
    large_client_header_buffers 16 128k;
    keepalive_requests 50000;
    http2_max_concurrent_streams 256;
    http2_push_preload on;
    postpone_output 0;
    tcp_nopush off;
    tcp_nodelay on;
    sendfile on;
    sendfile_max_chunk 512k;
    aio threads;
    directio 4m;

    # SSLåŒè¯ä¹¦é…ç½®
    ssl_certificate /etc/nginx/ssl/voidix.net/ECC/voidix.cer;
    ssl_certificate_key /etc/nginx/ssl/voidix.net/ECC/voidix.key;
    ssl_certificate /etc/nginx/ssl/voidix.net/RSA/voidix.cer;
    ssl_certificate_key /etc/nginx/ssl/voidix.net/RSA/voidix.key;

    # SSLä¼˜åŒ–é…ç½® (A+è¯„çº§)
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers 'ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-CHACHA20-POLY1305-SHA256:ECDHE-RSA-CHACHA20-POLY1305-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!SRP:!CAMELLIA:!DHE';
    ssl_prefer_server_ciphers on;
    ssl_session_cache shared:SSL:100m;
    ssl_session_timeout 24h;
    ssl_session_tickets off;
    ssl_buffer_size 4k;
    ssl_early_data on;
    ssl_conf_command Ciphersuites TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256;
    ssl_conf_command Options PrioritizeChaCha;
    ssl_conf_command Options NoRenegotiation;
    ssl_stapling on;
    ssl_stapling_verify on;
    ssl_trusted_certificate /etc/nginx/ssl/voidix.net/ECC/voidix.cer;
    resolver 8.8.8.8 8.8.4.4 valid=300s;
    resolver_timeout 5s;
    ssl_ecdh_curve X25519:X448:secp384r1:secp521r1:secp256r1;

    # å®‰å…¨ä¸æœåŠ¡æ ‡è¯†å¤´éƒ¨
    add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload" always;
    add_header X-Frame-Options "DENY" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    add_header X-CDN-Provider "Voidix-CDN-v2.0" always;
    add_header X-Served-By "cdn.voidix.net" always;

    # CDN å®æ—¶å‹ç¼©é…ç½®
    brotli on;
    brotli_comp_level 11;
    brotli_min_length 128;
    brotli_static on;
    brotli_types text/plain text/css text/xml text/javascript text/json application/javascript application/json application/xml application/xml+rss application/atom+xml application/rss+xml image/svg+xml font/woff font/woff2 font/ttf font/eot font/otf;

    gzip on;
    gzip_vary on;
    gzip_min_length 128;
    gzip_comp_level 9;
    gzip_static on;
    # âœ¨ OPTIMIZATION: ä¿æŒä¸Brotliçš„ç±»å‹ä¸€è‡´
    gzip_types text/plain text/css text/xml text/javascript text/json application/javascript application/json application/xml application/xml+rss application/atom+xml application/rss+xml image/svg+xml font/woff font/woff2 font/ttf font/eot font/otf;

    # Google Fonts CSS ä»£ç†
    location /fonts/css/ {
        limit_req zone=cdn_assets burst=20 nodelay;
        proxy_pass https://fonts.googleapis.com;
        proxy_cache voidix_cache;
        proxy_cache_key "fonts_css:$request_uri";
        proxy_cache_valid 200 14d;
        proxy_cache_use_stale error timeout invalid_header updating;
        add_header X-Cache-Status $upstream_cache_status always;
        add_header Cache-Control "public, max-age=1209600, immutable";
        add_header Access-Control-Allow-Origin "*" always;
        proxy_set_header Host "fonts.googleapis.com";
        rewrite ^/fonts/css/(.*)$ /$1 break;
    }

    # Google Fonts å­—ä½“æ–‡ä»¶ä»£ç†
    location /fonts/files/ {
        limit_req zone=cdn_assets burst=30 nodelay;
        proxy_pass https://fonts.gstatic.com;
        proxy_cache voidix_cache;
        proxy_cache_key "fonts_files:$request_uri";
        proxy_cache_valid 200 90d;
        proxy_cache_use_stale error timeout invalid_header updating;
        add_header X-Cache-Status $upstream_cache_status always;
        add_header Cache-Control "public, max-age=7776000, immutable";
        add_header Access-Control-Allow-Origin "*" always;
        proxy_set_header Host "fonts.gstatic.com";
        rewrite ^/fonts/files/(.*)$ /$1 break;
    }

    # å®‰å…¨ç­–ç•¥ - ç¦æ­¢ä»£ç†åˆ†æè„šæœ¬
    location ~* /(googletagmanager|google-analytics|lf1-cdn-tos\.bytegoofy) {
        return 403 "Analytics scripts are not allowed through this CDN.";
    }

    # CDN å¥åº·æ£€æŸ¥
    location = /cdn-status {
        access_log off;
        return 200 '{"status":"healthy","service":"voidix-cdn","version":"2.0"}';
        add_header Content-Type "application/json";
        add_header Cache-Control "no-cache";
    }

    # é»˜è®¤æ‹’ç»æ‰€æœ‰å…¶ä»–è¯·æ±‚
    location / {
        return 404 "CDN Service: Resource not found.";
    }

    access_log /var/log/nginx/cdn_access.log main_perf;
    error_log /var/log/nginx/cdn_error.log;
}
